angular.module("cms.shared").factory("shared.youTubeService",["$http","$q","shared.pluginServiceBase",function(r,n,e){var t,i={};return r.get(e+"youtube-settings").then(function(e){t=e.apiKey}),i.getVideoInfo=function(i){if(t)return function(){var t=n.defer();return r.get.apply(this,arguments).then(t.resolve).catch(function(e){404==e.status&&t.resolve(),t.reject(e)}),t.promise}("https://www.googleapis.com/youtube/v3/videos?id="+i+"&part=snippet&key="+t).then(function(e){if(e&&e.data&&e.data.items.length){var t=e.data.items[0].snippet,e=t.thumbnails.high,t={id:i,title:t.title,description:t.description,publishDate:t.publishedAt};return e&&(t.thumbnailUrl=e.url,t.thumbnailWidth=e.width,t.thumbnailHeight=e.height),t}});var e=n.defer();return e.resolve({id:i}),e.promise},i}]);
angular.module("cms.shared").directive("cmsFormFieldYoutube",["_","shared.pluginModulePath","shared.pluginContentPath","shared.modalDialogService","shared.stringUtilities","baseFormFieldFactory",function(m,s,e,c,o,l){var h=l.defaultConfig,e={templateUrl:s+"UIComponents/FormFieldYouTube.html",scope:m.extend(l.defaultConfig.scope,{modelType:"@cmsModelType"}),passThroughAttributes:["required"],link:function(e,o,l,t){var n=e.vm,r=m.has(l,"required");return n.showPicker=u,n.remove=i,n.isRemovable=n.model&&!r,a(),h.link(e,o,l,t);function i(){d(null)}function u(){c.show({templateUrl:s+"UIComponents/YouTubePickerDialog.html",controller:"YoutubePickerDialogController",options:{currentVideo:m.clone(n.model),modelType:n.modelType,onSelected:d}})}function d(e){e?(n.isRemovable=!r,n.model=e):(n.isRemovable=!1,n.model&&(n.model=null)),a()}function a(){n.buttonText=n.model?"Change":"Select"}}};return l.create(e)}]);
angular.module("cms.shared").directive("cmsFormFieldYoutubeId",["_","shared.pluginModulePath","shared.LoadState","shared.youTubeService","shared.validationErrorService","baseFormFieldFactory",function(a,e,l,c,s,m){e={templateUrl:e+"UIComponents/FormFieldYouTubeId.html",scope:a.extend(m.defaultConfig.scope,{onVideoSelected:"&cmsOnVideoSelected"}),passThroughAttributes:["required"],link:function(e,t,n,o){var d=e.vm;a.has(n,"required"),o[0];return function(){d.setEditing=r.bind(null,!0),d.updateVideoId=i,d.cancelEditing=u,d.updateIdLoadState=new l,e.$watch("vm.model",function(e){r(!e)})}(),m.defaultConfig.link(e,t,n,o);function i(){var e=d.idOrUrlInput,t=function(e){if(!e)return;if(/^[^"&?\/ ]{11}$/.test(e))return e;return(e=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i.exec(e))&&e[1]}(e);function n(e){d.onVideoSelected&&d.onVideoSelected({model:e})}function o(e){s.raise([{properties:[d.modelName],message:e}])}e?e&&!t?o("The url/id is invalid"):t&&t!=d.model?(d.updateIdLoadState.on(),c.getVideoInfo(t).then(function(e){e?(d.model=d.idOrUrlInput=t,n(e)):o("Video not found")}).catch(function(e){o("There was a problem accessing YouTube")}).finally(d.updateIdLoadState.off)):u():(d.model=null,n(null))}function u(){d.idOrUrlInput=d.model,d.onChange(),r(!1)}function r(e){d.isEditing=e}}};return m.create(e)}]);
angular.module("cms.shared").controller("YoutubePickerDialogController",["$scope","shared.LoadState","shared.stringUtilities","shared.youTubeService","options","close",function(e,o,d,l,n,t){var i=e;function r(e){i.model=e||null}function c(){t()}function a(){i.model&&i.isModelId?n.onSelected(i.model.id):n.onSelected(i.model),t()}i.onOk=a,i.onCancel=c,i.close=c,i.onVideoSelected=r,i.isModelId="id"===n.modelType,i.loadState=new o,i.isModelId&&n.currentVideo?(i.loadState.on(),youTubeService.getVideoInfo(n.currentVideo).then(r).finally(i.loadState.off)):i.model=n.currentVideo}]);
angular.module("cms.shared").directive("cmsYoutubeVideo",["$sce","shared.pluginModulePath","shared.pluginContentPath","shared.urlLibrary",function(l,e,r,t){return{restrict:"E",scope:{model:"=cmsModel"},templateUrl:e+"UIComponents/YouTubeVideo.html",link:function(t,e,o){t.replacementUrl=r+"img/AssetReplacement/youtube-replacement.png",t.$watch("model",function(e){e?(e=e.id||e,t.videoUrl=l.trustAsResourceUrl("https://www.youtube-nocookie.com/embed/"+e)):t.videoUrl=null})}}}]);